<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Socialite</title>
    <link rel="stylesheet" href="../stylesheets/feed.css">
    <link rel="stylesheet" href="../stylesheets/nav.css">
    <link rel="shortcut icon" href="../images/Socialite square dark.png" type="image/x-icon">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.2/css/all.css" integrity="sha384-vSIIfh2YWi9wW0r9iZe7RJPrKwp6bG+s9QZMoITbCckVJqGCCRhc+ccxNcdpHuYu" crossorigin="anonymous">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <link rel="stylesheet" type="text/css" href="../stylesheets/lightcase.css">
    <script type="text/javascript" src="../javascripts/lightcase.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.8/clipboard.min.js"></script>
</head>
<body>
    <nav>
        <div id="mobLogo">
            <a href="/profile">
                <img src="../images/Socialite square .png" alt="">
            </a>
        </div>
        <div id="logo">
            <a href="/profile">
                <img src="../images/Socialite full.png" alt="">
            </a>
        </div>
        <div id="search">
            <i class="fas fa-search"></i>
            <input type="text" placeholder="Search" id="searchBar">
            <div id="searchResultsContainer">
                
            </div>
        </div>
        <div id="links">
            <a id="prflLink" href="/profile">
                <img id="navPrflImg" src= <%=  data.profilePhoto %> alt="">
                <h6><%= data.name %></h6>
            </a>
            <a class="navLinks mobLinks" href="/newsFeed">News Feed</a>
            <a class="navLinks mobLinks" href="/messages">Chats</a>
            <a class="navLinks mobLinks" href="/logout">Logout</a>
            <div class="navLinks"><i id="settingBtn" class="fas fa-cog"></i></div>
        </div>
    </nav>

    <div id="menu">
        <a id="userInfo" href="/profile">
            <img src= <%=  data.profilePhoto %>  alt="">
            <h4><%= data.name %></h4>
        </a>
        <hr>
        <a class="menuLinks" href="/newsFeed"><i class="far fa-newspaper"></i>News Feed</a>
        <a class="menuLinks" href="/friends"><i class="fas fa-user-friends"></i>Friends</a>
        <a class="menuLinks" href="/messages"><i class="far fa-comment"></i>Chats</a>
        <a class="menuLinks" href="/contact"><i class="far fa-question-circle"></i>Help & Support</a>
        <a class="menuLinks" href="/contact"><i class="fas fa-ban"></i>Report a Bug</a>
        <a class="menuLinks" href="/pendingRequests"><i class="fas fa-user-plus"></i>Pending Friend Requests</a>
        <a class="menuLinks" href="/resetMyPassword"><i class="fas fa-shield-alt"></i>Reset Password</a>
        <a class="menuLinks" href="/aboutUs"><i class="fas fa-info-circle"></i>Legal</a>
        <a class="menuLinks" href="/logout"><i class="fas fa-sign-out-alt"></i>Log Out</a>
        
    </div>
    <div id="hero">
        <% if(messages.fileFormat){ %>
            <div id="errMsgDiv">
                <div id="errMsgDivHeader">
                    <i class="fas fa-exclamation-triangle"></i>
                    <h6>Files Not Allowed</h6>
                </div>
                <p class="messageErr">Only jpeg, jpg and png files under 1 mb size can be uploaded. Try again with the specified file format and size.</p>
                <button id="errMsgDivBtn">Close</button>
            </div>
        <% } %>
        <div id="showReactions">
           
        </div>
        <div id="postDelUpdate">
            
        </div>
        <div id="mid">
            <div class="card50" id="newPost">
                <img src=<%= data.profilePhoto %> id="prflImg" alt="">
                <div id="newPostForm">
                    <form action="/post" method="post" enctype="multipart/form-data" onsubmit=" validate(event);">
                        <textarea name="content" placeholder="What's on your mind?" id="postContentText" maxlength="500"></textarea>
                        <div id="formOpts">
                            <button id="selEmoji" class="keyBtn"><i class="far fa-smile-beam"></i></button>
                            <div class="wrapper">
                                <input type="file" id="file-input" name="postMedia">
                                <label for="file-input">
                                  <i class="fa fa-paperclip fa-2x"></i>
                                  <span></span>
                                </label>
                                <i class="fa fa-times-circle remove" ></i>
                              </div>
                            <input type="submit" value="Post" id="postSubmitBtn">
                        </div>
                    </form>
                </div>
            </div>
                <% var host = `${host}` %>
                <% var userId = `${data._id}` %>
                <% var dynaIds = 1 %>
                <% var dynamicIds = 1 %>
                <% var dynamicCommentIds = 1 %>
                <% var newCommentDynamic = 1 %>
                <% var newCommentId %>
                <% var friendsLength = `${friendsLength}` %>
                <% var noOfPosts = 0 %>
                <% var totalPosts = `${totalPosts}` %>
                <div id="posts">
                    <% if(totalPosts == 0){ %>
                        <div class="noPosts card50">
                            <img src="../images/none.svg" alt="">
                            <h6>OOPS..!! No posts to show.</h6>
                            <p>None of your friends have posted anything in last 24 hours. We suggest you to add more and more friends. For now, you can click the button below to view random recent posts.</p>
                            <button onclick="showRandomPosts()">View Recent Posts</button>
                        </div>
                        <div id="suggestions" class="card50">
                            <h6>Some suggestions from Socialite</h6>
                            <div class="suggestion">
                                <div class="dot"></div>
                                <p>Always keep your profile updated.</p>
                            </div>
                            <div class="suggestion">
                                <div class="dot"></div>
                                <p>Connect with people. Add more and more friends</p>
                            </div>
                            <div class="suggestion">
                                <div class="dot"></div>
                                <p>Post regularly. Share your ideas and post photos consistently.</p>
                            </div>
                            <div class="suggestion">
                                <div class="dot"></div>
                                <p>Never share your password with anyone.</p>
                            </div>
                            <div class="suggestion">
                                <div class="dot"></div>
                                <p>Create passwords that are hard to guess and don't use personal information.</p>
                            </div>
                            <div class="suggestion">
                                <div class="dot"></div>
                                <p>Change your password every month.</p>
                            </div>
                            <div class="suggestion">
                                <div class="dot"></div>
                                <p>Don't use same password at different places.</p>
                            </div>
                            <div class="suggestion">
                                <div class="dot"></div>
                                <p>Feel free to <a href="/contact">contact us</a> for any query.</p>
                            </div>
                        </div>
                    <% } %>

                    <% if(userPosts.length>0){ %>
                        <% userPosts.forEach(function(post){ %>
                            <% noOfPosts++ %>
                            <div class="post card50">
                                <div class="postHeader">
                                    <a href="/profile">
                                        <img src=<%= data.profilePhoto %> alt="">
                                    </a>
                                    <div class="postHeaderDets">
                                        <div class="postHeaderDetsTxt">
                                            <h6><%= data.name %>
                                                <% if(data.isVerified){ %>
                                                    <img src="data:image/svg+xml;base64,PHN2ZyBpZD0iTGF5ZXJfMSIgZW5hYmxlLWJhY2tncm91bmQ9Im5ldyAwIDAgNTExLjM3NSA1MTEuMzc1IiBoZWlnaHQ9IjUxMiIgdmlld0JveD0iMCAwIDUxMS4zNzUgNTExLjM3NSIgd2lkdGg9IjUxMiIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48Zz48cGF0aCBkPSJtNTExLjM3NSAyNTUuNjg3LTU3Ljg5LTY0LjI3MyA5LjA2NC04Ni4wNDUtODQuNjUtMTcuOTIxLTQzLjE4LTc1LjAxMS03OS4wMzEgMzUuMzItNzkuMDMxLTM1LjMyLTQzLjE4IDc1LjAxMS04NC42NSAxNy45MjEgOS4wNjMgODYuMDQ1LTU3Ljg5IDY0LjI3MyA1Ny44ODkgNjQuMjczLTkuMDYzIDg2LjA0NSA4NC42NSAxNy45MjEgNDMuMTggNzUuMDExIDc5LjAzMS0zNS4zMjEgNzkuMDMxIDM1LjMyMSA0My4xOC03NS4wMTEgODQuNjUtMTcuOTIxLTkuMDY0LTg2LjA0NXptLTE0OC40OTctNTUuOTg1LTEyOC4zNDUgMTQzLjc5Mi04OS4xODYtODkuMTg2IDIxLjIxMy0yMS4yMTMgNjYuNzM0IDY2LjczNCAxMDcuMjAzLTEyMC4xMDR6Ii8+PC9nPjwvc3ZnPg==" />
                                                <% } %></h6>
                                            <p><%= post.when %></p>
                                        </div>
                                        <div class="postHeaderDetsOpts">
                                            <div class="tooltip"> <button onclick="showEditPostDiv('<%= post._id %>')"><i class="fas fa-pencil-alt"></i></button>
                                                <span class="tooltiptext">Edit Post</span>
                                            </div>
                                            <div class="tooltip"> <button onclick="showDelPostDiv('<%= post._id %>')"><i class="far fa-trash-alt"></i></button>
                                                <span class="tooltiptext" >Delete Post</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="caption">
                                    <p><%=post.content%></p>
                                </div>
                                <% if(post.media != null){ %>
                                    <a draggable="false" href=<%= post.media %> data-rel="lightcase" class="postImage">
                                        <img src=<%= post.media %>  alt="">
                                    </a>
                                <% } %>
                                <% var postLikesId  %>
                                <% var postOptsLikesId  %>
                                <div class="postReactions">
                                    <a href= <%= `/likedBy/${post._id}` %>>
                                        <% postLikesId = `postLikes-${dynaIds++}` %>
                                        <div class="postLikes" id=<%= postLikesId%>>
                                            <i class="fas fa-thumbs-up likeIcon"></i>
                                            <div class="postLikeNames">
                                                <% if(post.reactions.length >= 3){ %>
                                                    <p><%= `Liked by ${post.reactions[0].name} and ${post.reactions.length -1} other` %></p>
                                                <% }else if(post.reactions.length == 2  ){ %>
                                                    <p><%= `Liked by ${post.reactions[0].name} and ${post.reactions[1].name}` %></p>
                                                <% }else if(post.reactions.length == 1){ %>
                                                    <p><%= `Liked by ${post.reactions[0].name}` %></p>
                                                <% } else{ %>
                                                    <p>0 Likes</p>
                                                <% } %>
                                            </div>
                                            <p class="mobPostLikes"><%= post.reactions.length %> Likes</p>
                                        </div>
                                    </a>
                                    <a href=<%= `/post/${post._id}` %>>
                                        <p class="postComments"><%= post.comments.length %> Comments</p>
                                    </a>
                                    <!-- <button class="btn" data-clipboard-text="anc">
                                        Copy to clipboard
                                    </button> -->
                                </div>
                                <div class="postOptions">
                                    <% postOptsLikesId = `postOptsLikes-${dynamicIds++}` %>
                                    <button  onclick="likePost('<%= post._id %>','<%= dynamicIds-1 %>')" class="postOpts" id= <%= postOptsLikesId %>>
                                        <% if(post.reactions.find(o => o.username === `${data.username}`)){ %>
                                            <i class="fas fa-thumbs-up likeIcon"></i>
                                            <p class="likeText">Liked</p>
                                        <% }else{ %>
                                            <i class="far fa-thumbs-up postOptsIcon"></i>
                                            <p>Like</p>
                                        <% } %>


                                    </button>
                                    <a href=<%= `/post/${post._id}` %> class="postOpts">
                                        <i class="far fa-comment-alt postOptsIcon"></i>
                                        <p>Comments</p>
                                    </a>
                                    <button class="btn postOpts" onclick="showAlert()" data-clipboard-text=<%= `${host}/post/${post._id}` %>>
                                        <i class="far fa-clipboard postOptsIcon"></i>
                                        <p>Copy Link</p>
                                    </button>
                                </div>
                                <div class="comments">
                                    <% if(post.comments.length >= 1){ %>
                                        <% var a = (`${post.comments.length}` >= 2) ? 2 : `${post.comments.length}`  %>
                                        <% for(var i=0;i<a;i++) { %>
                                            <div class="comment">
                                                
                                                <a href=<%= `/profile/${post.comments[i].userid._id}` %> class="commentUserProfile">
                                                    <img src=<%=post.comments[i].userid.profilePhoto %> alt="">
                                                </a>
                                                <div class="commentDets">
                                                    <div class="commentDetsInfo">
                                                        <a href= <%= `/profile/${post.comments[i].userid._id}`%>>
                                                            <h6><%=post.comments[i].userid.name %></h6>
                                                            <p><%=post.comments[i].when %></p>
                                                        </a>
                                                        <div class="commentDetsOpts">
                                                            <% if(post.comments[i].userid._id == `${data._id}`){ %>
                                                                <div class="tooltip"> <button onclick="showEditCommentDiv('<%= post.comments[i]._id %>')"> <i class="fas fa-pencil-alt"></i> </button>
                                                                    <span class="tooltiptext">Edit Comment</span>
                                                                </div>
                                                            <% } %>
                                                            <div class="tooltip"> <button onclick="showDelCommentDiv('<%= post.comments[i]._id %>','<%= post._id %>')"><i class="far fa-trash-alt"></i></button>
                                                                <span class="tooltiptext" >Delete Comment</span>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <% var commentsOptsId %>
                                                    <div class="commentContent">
                                                        <p><%= post.comments[i].cmnt %></p>
                                                        <% commentsOptsId = `commentReacts-${dynamicCommentIds++}` %>
                                                        <div class="commentReacts" id= <%= commentsOptsId %>>
                                                            <button onclick="likeComment('<%= post.comments[i]._id %>','<%= dynamicCommentIds-1 %>')" class="commentReactions">
                                                                <% if(post.comments[i].reactions.find(o => o.username === `${data.username}`)){ %>
                                                                    <i class="fas fa-thumbs-up likeText"></i>
                                                                    <p class="likeText">Liked</p>
                                                                <% }else{ %>
                                                                    <i class="far fa-thumbs-up"></i>
                                                                    <p>Like</p>
                                                                <% } %>  
                                                                </button>
                                                            <% if(`${post.comments[i].reactions.length}` > 0) { %>
                                                                <button class="commentReactLen" onclick="showReactionDiv('<%=post.comments[i]._id %>')"><%=`( ${post.comments[i].reactions.length} Likes )` %></button>
                                                            <% }%>

                                                        </div>
                                                        
                                                    </div>
                                                </div>
                                            </div>
                                        <% } %>
                                        <% if(post.comments.length > 2){ %>
                                            <a href= <%=`/post/${post._id}`%> class="viewAllComments">View all comments <i class="fas fa-arrow-right"></i></a>
                                        <% } %>
                                    <% } %>

        
                                </div>
                                <div class="addComment">
                                    <a href="/profile" class="commentUserProfile">
                                        <img src=<%= data.profilePhoto %> alt="">
                                    </a>
                                    <% newCommentId = `newCommentId-${newCommentDynamic++}` %>
                                    <form action=<%= `/comment/${post._id}` %> onsubmit="addNewComment(event,'<%=newCommentDynamic-1%>')" method="POST">
                                        <textarea name="comment" placeholder="Write a comment" id=<%= newCommentId %> maxlength="500"></textarea>
                                        <input type="submit" value="Add Comment">
                                    </form>
                                </div>
                            </div>
                        <% }) %>
                    <% } %>









                    <% if(data.friends.length > 0){ %>
                        <% data.friends.forEach(function(friend){ %>
                            <% if(friend.posts.length>0){ %>
                                <% friend.posts.forEach(function(post){ %>
                                    <% noOfPosts++ %>
                                    <div class="post card50">
                                        <div class="postHeader">
                                            <a href= <%= `/profile/${friend._id}` %>>
                                                <img src=<%= friend.profilePhoto %> alt="">
                                            </a>
                                            <div class="postHeaderDets">
                                                <div class="postHeaderDetsTxt">
                                                    <h6><%= friend.name %>
                                                        <% if(friend.isVerified){ %>
                                                            <img src="data:image/svg+xml;base64,PHN2ZyBpZD0iTGF5ZXJfMSIgZW5hYmxlLWJhY2tncm91bmQ9Im5ldyAwIDAgNTExLjM3NSA1MTEuMzc1IiBoZWlnaHQ9IjUxMiIgdmlld0JveD0iMCAwIDUxMS4zNzUgNTExLjM3NSIgd2lkdGg9IjUxMiIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48Zz48cGF0aCBkPSJtNTExLjM3NSAyNTUuNjg3LTU3Ljg5LTY0LjI3MyA5LjA2NC04Ni4wNDUtODQuNjUtMTcuOTIxLTQzLjE4LTc1LjAxMS03OS4wMzEgMzUuMzItNzkuMDMxLTM1LjMyLTQzLjE4IDc1LjAxMS04NC42NSAxNy45MjEgOS4wNjMgODYuMDQ1LTU3Ljg5IDY0LjI3MyA1Ny44ODkgNjQuMjczLTkuMDYzIDg2LjA0NSA4NC42NSAxNy45MjEgNDMuMTggNzUuMDExIDc5LjAzMS0zNS4zMjEgNzkuMDMxIDM1LjMyMSA0My4xOC03NS4wMTEgODQuNjUtMTcuOTIxLTkuMDY0LTg2LjA0NXptLTE0OC40OTctNTUuOTg1LTEyOC4zNDUgMTQzLjc5Mi04OS4xODYtODkuMTg2IDIxLjIxMy0yMS4yMTMgNjYuNzM0IDY2LjczNCAxMDcuMjAzLTEyMC4xMDR6Ii8+PC9nPjwvc3ZnPg==" />
                                                        <% } %></h6>
                                                    <p><%= post.when %></p>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="caption">
                                            <p><%=post.content%></p>
                                        </div>
                                        <% if(post.media != null){ %>
                                            <a draggable="false" href=<%= post.media %> data-rel="lightcase" class="postImage">
                                                <img src=<%= post.media %>  alt="">
                                            </a>
                                        <% } %>
                                        <% var postLikesId  %>
                                        <% var postOptsLikesId  %>
                                        <div class="postReactions">
                                            <a href= <%= `/likedBy/${post._id}` %>>
                                                <% postLikesId = `postLikes-${dynaIds++}` %>
                                                <div class="postLikes" id=<%= postLikesId%>>
                                                    <i class="fas fa-thumbs-up likeIcon"></i>
                                                    <div class="postLikeNames">
                                                        <% if(post.reactions.length >= 3){ %>
                                                            <p><%= `Liked by ${post.reactions[0].name} and ${post.reactions.length -1} other` %></p>
                                                        <% }else if(post.reactions.length == 2  ){ %>
                                                            <p><%= `Liked by ${post.reactions[0].name} and ${post.reactions[1].name}` %></p>
                                                        <% }else if(post.reactions.length == 1){ %>
                                                            <p><%= `Liked by ${post.reactions[0].name}` %></p>
                                                        <% } else{ %>
                                                            <p>0 Likes</p>
                                                        <% } %>
                                                    </div>
                                                    <p class="mobPostLikes"><%= post.reactions.length %> Likes</p>
                                                </div>
                                            </a>
                                            <a href=<%= `/post/${post._id}` %>>
                                                <p class="postComments"><%= post.comments.length %> Comments</p>
                                            </a>
                                            <!-- <button class="btn" data-clipboard-text="anc">
                                                Copy to clipboard
                                            </button> -->
                                        </div>
                                        <div class="postOptions">
                                            <% postOptsLikesId = `postOptsLikes-${dynamicIds++}` %>
                                            <button  onclick="likePost('<%= post._id %>','<%= dynamicIds-1 %>')" class="postOpts" id= <%= postOptsLikesId %>>
                                                <% if(post.reactions.find(o => o.username === `${data.username}`)){ %>
                                                    <i class="fas fa-thumbs-up likeIcon"></i>
                                                    <p class="likeText">Liked</p>
                                                <% }else{ %>
                                                    <i class="far fa-thumbs-up postOptsIcon"></i>
                                                    <p>Like</p>
                                                <% } %>
        
        
                                            </button>
                                            <a href=<%= `/post/${post._id}` %> class="postOpts">
                                                <i class="far fa-comment-alt postOptsIcon"></i>
                                                <p>Comments</p>
                                            </a>
                                            <button class="btn postOpts" onclick="showAlert()" data-clipboard-text=<%= `${host}/post/${post._id}` %>>
                                                <i class="far fa-clipboard postOptsIcon"></i>
                                                <p>Copy Link</p>
                                            </button>
                                        </div>
                                        <div class="comments">
                                            <% if(post.comments.length >= 1){ %>
                                                <% var a = (`${post.comments.length}` >= 2) ? 2 : `${post.comments.length}`  %>
                                                <% for(var i=0;i<a;i++) { %>
                                                    <div class="comment">
                                                        
                                                        <a href=<%= `/profile/${post.comments[i].userid._id}` %> class="commentUserProfile">
                                                            <img src=<%=post.comments[i].userid.profilePhoto %> alt="">
                                                        </a>
                                                        <div class="commentDets">
                                                            <div class="commentDetsInfo">
                                                                <a href= <%= `/profile/${post.comments[i].userid._id}`%>>
                                                                    <h6><%=post.comments[i].userid.name %></h6>
                                                                    <p><%=post.comments[i].when %></p>
                                                                </a>
                                                                <div class="commentDetsOpts">
                                                                    <% if(post.comments[i].userid._id == `${data._id}`){ %>
                                                                        <div class="tooltip"> <button onclick="showEditCommentDiv('<%= post.comments[i]._id %>')"> <i class="fas fa-pencil-alt"></i> </button>
                                                                            <span class="tooltiptext">Edit Comment</span>
                                                                        </div>
                                                                        <div class="tooltip"> <button onclick="showDelCommentDiv('<%= post.comments[i]._id %>','<%= post._id %>')"><i class="far fa-trash-alt"></i></button>
                                                                            <span class="tooltiptext" >Delete Comment</span>
                                                                        </div>
                                                                    <% } %>
                                                                </div>
                                                            </div>
                                                            <% var commentsOptsId %>
                                                            <div class="commentContent">
                                                                <p><%= post.comments[i].cmnt %></p>
                                                                <% commentsOptsId = `commentReacts-${dynamicCommentIds++}` %>
                                                                <div class="commentReacts" id= <%= commentsOptsId %>>
                                                                    <button onclick="likeComment('<%= post.comments[i]._id %>','<%= dynamicCommentIds-1 %>')" class="commentReactions">
                                                                        <% if(post.comments[i].reactions.find(o => o.username === `${data.username}`)){ %>
                                                                            <i class="fas fa-thumbs-up likeText"></i>
                                                                            <p class="likeText">Liked</p>
                                                                        <% }else{ %>
                                                                            <i class="far fa-thumbs-up"></i>
                                                                            <p>Like</p>
                                                                        <% } %>  
                                                                        </button>
                                                                    <% if(`${post.comments[i].reactions.length}` > 0) { %>
                                                                        <button class="commentReactLen" onclick="showReactionDiv('<%=post.comments[i]._id %>')"><%=`( ${post.comments[i].reactions.length} Likes )` %></button>
                                                                    <% }%>
        
                                                                </div>
                                                                
                                                            </div>
                                                        </div>
                                                    </div>
                                                <% } %>
                                                <% if(post.comments.length > 2){ %>
                                                    <a href= <%=`/post/${post._id}`%> class="viewAllComments">View all comments <i class="fas fa-arrow-right"></i></a>
                                                <% } %>
                                            <% } %>
        
                
                                        </div>
                                        <div class="addComment">
                                            <a href="/profile" class="commentUserProfile">
                                                <img src=<%= data.profilePhoto %> alt="">
                                            </a>
                                            <% newCommentId = `newCommentId-${newCommentDynamic++}` %>
                                            <form action=<%= `/comment/${post._id}` %> onsubmit="addNewComment(event,'<%=newCommentDynamic-1%>')" method="POST">
                                                <textarea name="comment" placeholder="Write a comment" id=<%= newCommentId %>></textarea>
                                                <input type="submit" value="Add Comment">
                                            </form>
                                        </div>
                                    </div>
                                <% }) %>
                            <% } %>

                        <% }) %>
                    <% } %>
                </div>
                <div id="showMoreDiv">
                    
                </div>
        </div>
        <div id="right">
            <div class="rightHeader">
                <h6>Chats</h6>
                <a href="/messages">All chats</a>
            </div>
            <% var other %>
            <div class="chatsList">
                <% if(messagesList.length > 0){ %>
                    <% messagesList.forEach(function(chat){ %>
                        <% data.username == chat.author.username ? other = chat.receiver : other = chat.author %>
                        <a href= <%= `/chat/${other._id}` %> class="list">
                            <img class="listImg" src= <%= other.profilePhoto %> alt="">
                            <h6 class="listName"><%= other.name %><% if(other.isVerified){ %>
                                <img class="verifiedLogo" src="data:image/svg+xml;base64,PHN2ZyBpZD0iTGF5ZXJfMSIgZW5hYmxlLWJhY2tncm91bmQ9Im5ldyAwIDAgNTExLjM3NSA1MTEuMzc1IiBoZWlnaHQ9IjUxMiIgdmlld0JveD0iMCAwIDUxMS4zNzUgNTExLjM3NSIgd2lkdGg9IjUxMiIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48Zz48cGF0aCBkPSJtNTExLjM3NSAyNTUuNjg3LTU3Ljg5LTY0LjI3MyA5LjA2NC04Ni4wNDUtODQuNjUtMTcuOTIxLTQzLjE4LTc1LjAxMS03OS4wMzEgMzUuMzItNzkuMDMxLTM1LjMyLTQzLjE4IDc1LjAxMS04NC42NSAxNy45MjEgOS4wNjMgODYuMDQ1LTU3Ljg5IDY0LjI3MyA1Ny44ODkgNjQuMjczLTkuMDYzIDg2LjA0NSA4NC42NSAxNy45MjEgNDMuMTggNzUuMDExIDc5LjAzMS0zNS4zMjEgNzkuMDMxIDM1LjMyMSA0My4xOC03NS4wMTEgODQuNjUtMTcuOTIxLTkuMDY0LTg2LjA0NXptLTE0OC40OTctNTUuOTg1LTEyOC4zNDUgMTQzLjc5Mi04OS4xODYtODkuMTg2IDIxLjIxMy0yMS4yMTMgNjYuNzM0IDY2LjczNCAxMDcuMjAzLTEyMC4xMDR6Ii8+PC9nPjwvc3ZnPg==" />
                            <% } %></h6>
                        </a>
                    <% }) %>
                <% }else{ %>
                    <div class="notAvailable">
                        <h5>No chats to show</h5>
                        <a href="/friends">Start chatting</a>
                    </div>
                <% } %>
            </div>
            <div class="rightHeader">
                <h6>Birthdays</h6>
            </div>
            <div class="birthDayContainer">
                <% var d = new Date(); %>
                <% var currentMonth = d.getMonth() + 1 %>
                <% var bdayCount = 0 %>
                <% var currentDay = d.getDate() %>
                <% if (currentMonth < 10) { currentMonth = '0' + currentMonth; } %>
                <% if (currentDay < 10) { currentDay = '0' + currentDay; } %>
                <% data.friends.forEach(function(friend){ %>
                <% if(friend.dob != undefined){ %>
                    <% const [year,month,day] = friend.dob.split('-') %>
                    
                    <% if(month == currentMonth && day == currentDay ){ %>
                        <div class="bdayList">
                            <div class="birthdayListLeft">
                                <img class="listImg"  src= <%= friend.profilePhoto %> alt="">
                                <h6 class="listName"><%= friend.name %> <% if(friend.isVerified){ %>
                                    <img class="verifiedLogo" src="data:image/svg+xml;base64,PHN2ZyBpZD0iTGF5ZXJfMSIgZW5hYmxlLWJhY2tncm91bmQ9Im5ldyAwIDAgNTExLjM3NSA1MTEuMzc1IiBoZWlnaHQ9IjUxMiIgdmlld0JveD0iMCAwIDUxMS4zNzUgNTExLjM3NSIgd2lkdGg9IjUxMiIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48Zz48cGF0aCBkPSJtNTExLjM3NSAyNTUuNjg3LTU3Ljg5LTY0LjI3MyA5LjA2NC04Ni4wNDUtODQuNjUtMTcuOTIxLTQzLjE4LTc1LjAxMS03OS4wMzEgMzUuMzItNzkuMDMxLTM1LjMyLTQzLjE4IDc1LjAxMS04NC42NSAxNy45MjEgOS4wNjMgODYuMDQ1LTU3Ljg5IDY0LjI3MyA1Ny44ODkgNjQuMjczLTkuMDYzIDg2LjA0NSA4NC42NSAxNy45MjEgNDMuMTggNzUuMDExIDc5LjAzMS0zNS4zMjEgNzkuMDMxIDM1LjMyMSA0My4xOC03NS4wMTEgODQuNjUtMTcuOTIxLTkuMDY0LTg2LjA0NXptLTE0OC40OTctNTUuOTg1LTEyOC4zNDUgMTQzLjc5Mi04OS4xODYtODkuMTg2IDIxLjIxMy0yMS4yMTMgNjYuNzM0IDY2LjczNCAxMDcuMjAzLTEyMC4xMDR6Ii8+PC9nPjwvc3ZnPg==" />
                                <% } %> </h6>
                            </div>
                            <a href=<%= `/chat/${friend._id}`%> class="birthdayListRight" >Wish now</a>
                        </div>
                        <% bdayCount++ %>
                    <% } %>
                <% } %>
                <% }) %>
                <% if(bdayCount == 0){ %>
                    <div class="notAvailable">
                        <h5>None of your friends have birthday today</h5>
                    </div>
                <% } %>
            </div>
            <div class="rightHeader">
                <h6>Friends</h6>
                <a href="/friends">All Friends</a>
            </div>
            <% var friendsLen %>
            <% data.friends.length >= 4 ? friendsLen = 4 : friendsLen = data.friends.length %>
            
            <div class="friendsContainer">
                <% for(var i=0;i<friendsLen; i++){ %>
                    <a href= <%= `/profile/${data.friends[i]._id}` %> class="list">
                        <img class="listImg" src= <%= data.friends[i].profilePhoto %> alt="">
                        <h6 class="listName"><%= data.friends[i].name %> <% if(data.friends[i].isVerified){ %>
                            <img class="verifiedLogo" src="data:image/svg+xml;base64,PHN2ZyBpZD0iTGF5ZXJfMSIgZW5hYmxlLWJhY2tncm91bmQ9Im5ldyAwIDAgNTExLjM3NSA1MTEuMzc1IiBoZWlnaHQ9IjUxMiIgdmlld0JveD0iMCAwIDUxMS4zNzUgNTExLjM3NSIgd2lkdGg9IjUxMiIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48Zz48cGF0aCBkPSJtNTExLjM3NSAyNTUuNjg3LTU3Ljg5LTY0LjI3MyA5LjA2NC04Ni4wNDUtODQuNjUtMTcuOTIxLTQzLjE4LTc1LjAxMS03OS4wMzEgMzUuMzItNzkuMDMxLTM1LjMyLTQzLjE4IDc1LjAxMS04NC42NSAxNy45MjEgOS4wNjMgODYuMDQ1LTU3Ljg5IDY0LjI3MyA1Ny44ODkgNjQuMjczLTkuMDYzIDg2LjA0NSA4NC42NSAxNy45MjEgNDMuMTggNzUuMDExIDc5LjAzMS0zNS4zMjEgNzkuMDMxIDM1LjMyMSA0My4xOC03NS4wMTEgODQuNjUtMTcuOTIxLTkuMDY0LTg2LjA0NXptLTE0OC40OTctNTUuOTg1LTEyOC4zNDUgMTQzLjc5Mi04OS4xODYtODkuMTg2IDIxLjIxMy0yMS4yMTMgNjYuNzM0IDY2LjczNCAxMDcuMjAzLTEyMC4xMDR6Ii8+PC9nPjwvc3ZnPg==" />
                        <% } %></h6>
                    </a>
                <% } %> 
                <% if(friendsLen == 0){ %>
                    <div class="notAvailable">
                        <h5>No Friends Added</h5>
                    </div>
                <% } %>
            </div>
        </div>
    </div>
    <script src="../javascripts/profile.js"></script>   
    <script src="../javascripts/nav.js"></script>
    <script src="../javascripts/fgEmojiPicker.js"></script>
    
    <script>
        const emojiPicker = new FgEmojiPicker({
            trigger: ['#selEmoji'],
            removeOnSelection: false,
            closeButton: true,
            position: ['bottom', 'right'],
            preFetch: true,
            insertInto: document.querySelector('#postContentText'),
            emit(obj, triggerElement) {
                // console.log(obj, triggerElement);
            }
        });
    </script>
    <script>
        $("document").ready(function () {
    var $file = $("#file-input"),
      $label = $file.next("label"),
      $labelText = $label.find("span"),
      $labelRemove = $("i.remove"),
      labelDefault = $labelText.text();
  
    // on file change
    $file.on("change", function (event) {
      var fileName = $file.val().split("\\").pop();
      if (fileName) {
        console.log($file);
        $labelText.text(fileName);
        $labelRemove.show();
      } else {
        $labelText.text(labelDefault);
        $labelRemove.hide();
      }
    });
  
    // Remove file
    $labelRemove.on("click", function (event) {
      $file.val("");
      $labelText.text(labelDefault);
      $labelRemove.hide();
      console.log($file);
    });
  });
  
        jQuery(document).ready(function($) {
		$('a[data-rel^=lightcase]').lightcase();
	});

    new ClipboardJS('.btn');
    function showAlert(){
        alert('Copied');
    }

   function likePost(postId,num){
            var likeDivId = `#postOptsLikes-${num}`;
            var likedById = `#postLikes-${num}`;
            var likeDiv = document.querySelector(`${likeDivId}`);
            var likedByDiv = document.querySelector(`${likedById}`);
            fetch(`/post/${postId}/like`)
            .then(reactedPost => reactedPost.json())
            .then(function(data){
                if(data.reacted.find(o => o.username == data.user.username)){
                    likeDiv.innerHTML = '<i class="fas fa-thumbs-up likeIcon"></i><p class="likeText">Liked</p>';

                }else{
                    likeDiv.innerHTML = '<i class="far fa-thumbs-up postOptsIcon"></i><p>Like</p>';
                }
                if(window.innerWidth > 600){
                    if(data.reacted.length >= 3){
                        likedByDiv.innerHTML = `<i class="fas fa-thumbs-up likeIcon"></i><p>Liked by ${data.reacted[0].name} and ${data.reacted.length -1} other</p>`;
                    }else if(data.reacted.length == 2  ){
                        likedByDiv.innerHTML=
                        `<i class="fas fa-thumbs-up likeIcon"></i><p>Liked by ${data.reacted[0].name} and ${data.reacted[1].name}</p>`
                    }else if(data.reacted.length == 1){
                        likedByDiv.innerHTML= `<i class="fas fa-thumbs-up likeIcon"></i><p>Liked by ${data.reacted[0].name}</p>`
                        
                    } else{
                        likedByDiv.innerHTML= `<i class="fas fa-thumbs-up likeIcon"></i><p>0 Likes</p>`     
                    }
                }
                else{
                    likedByDiv.innerHTML = `<i class="fas fa-thumbs-up likeIcon"></i><p>${data.reacted.length} Likes</p>`;
                }
            })
        }
    
    function likeComment(commentId,num){
        var likeCommentDivId = `#commentReacts-${num}`;
        var likeCommentDiv = document.querySelector(`${likeCommentDivId}`)
        fetch(`/comment/${commentId}/like`)
        .then(foundComment => foundComment.json())
        .then(function(data){
            var stringParts = '';
            stringParts = `
            <button onclick="likeComment('${commentId}','${num}')" class="commentReactions">`;
            if(data.reacted.find(o => o.username == `${data.user.username}`)){
                stringParts += `
                <i class="fas fa-thumbs-up likeText"></i>
                <p class="likeText">Liked</p>`;
            }else{
                stringParts += `
                <i class="far fa-thumbs-up"></i>
                <p>Like</p>`;
            }
            stringParts += `
            </button>`;
        if(`${data.reacted.length}` > 0) {
            stringParts += `
            <button class="commentReactLen" onclick="showReactionDiv('${commentId}')">( ${data.reacted.length} Likes )</button>`;
        }
        likeCommentDiv.innerHTML = stringParts;
        })
    }

    function addNewComment(event,num){
        var newCommentId = `#newCommentId-${num}`;
    var newCommentText = document.querySelector(`${newCommentId}`);
    if(newCommentText.value.trim() == ""){
        event.preventDefault();
        alert("Enter Comment");
    }
   }
    </script>
    <script>
        let currentscrollHeight = 0;
        var friendsLength = "<%= friendsLength %>";
        var pages = Math.ceil((friendsLength-10)/10);
        var limit = pages>= 1 ? 1 : 0;
        var noOfPosts = "<%=noOfPosts %>";
        var dynaIds = "<%=dynaIds %>";
        var dynamicIds = "<%=dynamicIds %>";
        var dynamicCommentIds = "<%=dynamicCommentIds %>";
        var newCommentDynamic = "<%=newCommentDynamic %>";
        var postsDiv = document.querySelector('#posts');
        var totalPosts = "<%= totalPosts%>";
        var showMoreDiv = document.querySelector('#showMoreDiv');
        var isShown = false;
        if(noOfPosts <=3){
            window.scrollTo(0, 20);
            window.scrollTo(0, 0);
        }
            $(window).on("scroll", () => {
            const scrollHeight = $(document).height();
            const scrollPos = Math.floor($(window).height() + $(window).scrollTop());
            const isBottom = scrollHeight - 500 < scrollPos;
            if (isBottom && ( currentscrollHeight < scrollHeight ) && pages >= limit && pages >=1) {
                fetch(`/newsFeed/${limit}`)
                .then(data => data.json())
                .then(function(mergeData){
                    mergeData.data.friends.forEach(function(friend){
                        if(friend.posts.length>0){
                            friend.posts.forEach(function(post){
                            noOfPosts++;
                            var strParts = `<div class="post card50">
                                        <div class="postHeader">
                                            <a href= /profile/${friend._id}>
                                                <img src= ${friend.profilePhoto} alt="">
                                            </a>
                                            <div class="postHeaderDets">
                                                <div class="postHeaderDetsTxt">
                                                    <h6>${friend.name}`;
                                                        if(friend.isVerified){
                                                            strParts += `<img src="data:image/svg+xml;base64,PHN2ZyBpZD0iTGF5ZXJfMSIgZW5hYmxlLWJhY2tncm91bmQ9Im5ldyAwIDAgNTExLjM3NSA1MTEuMzc1IiBoZWlnaHQ9IjUxMiIgdmlld0JveD0iMCAwIDUxMS4zNzUgNTExLjM3NSIgd2lkdGg9IjUxMiIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48Zz48cGF0aCBkPSJtNTExLjM3NSAyNTUuNjg3LTU3Ljg5LTY0LjI3MyA5LjA2NC04Ni4wNDUtODQuNjUtMTcuOTIxLTQzLjE4LTc1LjAxMS03OS4wMzEgMzUuMzItNzkuMDMxLTM1LjMyLTQzLjE4IDc1LjAxMS04NC42NSAxNy45MjEgOS4wNjMgODYuMDQ1LTU3Ljg5IDY0LjI3MyA1Ny44ODkgNjQuMjczLTkuMDYzIDg2LjA0NSA4NC42NSAxNy45MjEgNDMuMTggNzUuMDExIDc5LjAzMS0zNS4zMjEgNzkuMDMxIDM1LjMyMSA0My4xOC03NS4wMTEgODQuNjUtMTcuOTIxLTkuMDY0LTg2LjA0NXptLTE0OC40OTctNTUuOTg1LTEyOC4zNDUgMTQzLjc5Mi04OS4xODYtODkuMTg2IDIxLjIxMy0yMS4yMTMgNjYuNzM0IDY2LjczNCAxMDcuMjAzLTEyMC4xMDR6Ii8+PC9nPjwvc3ZnPg==" />`;
                                                        }
                                                        strParts+=`
                                                        </h6>
                                                    <p>${post.when}</p>
                                                </div> `;
                        strParts += ` 
                                            </div>
                                        </div>
                                        <div class="caption">
                                            <p>${post.content}</p>
                                        </div>`;
                                        jQuery(document).ready(function($) {
                                            $('a[data-rel^=lightcase]').lightcase();
                                        });
    
                                        if( post.media != null){
    
                                            strParts += `<a draggable="false" href= ${post.media} data-rel="lightcase" class="postImage">
                                                <img src= ${post.media}  alt="">
                                            </a>`;
                                        }
                                        postLikesId = `postLikes-${dynaIds++}`;
                                            strParts += `<div class="postReactions">
                                            <a href= /likedBy/${post._id}>
                                                <div class="postLikes" id= ${postLikesId}>
                                                    <i class="fas fa-thumbs-up likeIcon"></i><div class="postLikeNames">`;
                                            if(post.reactions.length >= 3){
                                                strParts += 
                                                `<p>Liked by ${post.reactions[0].name} and ${post.reactions.length -1} other</p>`;
                                            }else if(post.reactions.length == 2  ){
                                                strParts +=
                                                `<p>Liked by ${post.reactions[0].name} and ${post.reactions[1].name}</p>`
                                            }else if(post.reactions.length == 1){
                                                strParts += `<p>Liked by ${post.reactions[0].name}</p>`
                                                
                                            } else{
                                                strParts += `<p>0 Likes</p>`     
                                            }
                                            postOptsLikesId = `postOptsLikes-${dynamicIds++}`;
                                            
                                            strParts += `</div>
                                            <p class="mobPostLikes">${post.reactions.length} Likes</p>
                                                </div>
                                            </a>
                                            <a href= /post/${post._id}>
                                                <p class="postComments">${post.comments.length } Comments</p>
                                            </a>
                                        </div>
                                        <div class="postOptions">
                                            <button onclick="likePost('${post._id}','${dynamicIds-1}')" class="postOpts" id=${postOptsLikesId}>`;
                                                   
                                                if(post.reactions.find(o => o.username === mergeData.data.username)){
                                                    strParts += `
                                                    <i class="fas fa-thumbs-up likeIcon"></i>
                                                    <p class="likeText">Liked</p>`;
                                                }else{
                                                    strParts += `
                                                    <i class="far fa-thumbs-up postOptsIcon"></i>
                                                    <p>Like</p>`;
                                                } 
    
                                        strParts += ` </button>
                                            <a href= /post/${post._id} class="postOpts">
                                                <i class="far fa-comment-alt postOptsIcon"></i>
                                                <p>Comments</p>
                                            </a>
                                            <button class="btn postOpts" onclick="showAlert()" data-clipboard-text= ${mergeData.host}/post/${post._id}>
                                                <i class="far fa-clipboard postOptsIcon"></i>
                                                <p>Copy Link</p>
                                            </button>
                                        </div>
                                        <div class="comments"> `;       
    
                                                
                                            if(post.comments.length >= 1){
                                                var a = (post.comments.length >= 2) ? 2 : post.comments.length
                                                for(var i=0;i<a;i++) {
                                                    commentsOptsId = `commentReacts-${dynamicCommentIds++}`;
                                                    strParts += `
                                                    <div class="comment">
                                                        
                                                        <a href= /profile/${post.comments[i].userid._id} class="commentUserProfile">
                                                            <img src= ${post.comments[i].userid.profilePhoto} alt="">
                                                        </a>
                                                        <div class="commentDets">
                                                            <div class="commentDetsInfo">
                                                                <a href= /profile/${post.comments[i].userid._id}>
                                                                    <h6>${post.comments[i].userid.name}</h6>
                                                                    <p>${post.comments[i].when} </p>
                                                                </a>
                                                                <div class="commentDetsOpts"> `;
    
                                                                    if(post.comments[i].userid._id == mergeData.data._id){
                                                                        var part = '<div class="tooltip"> <button onclick="showEditCommentDiv(\'' + post.comments[i]._id + '\')"><i class="fas fa-pencil-alt"></i></button><span class="tooltiptext">Edit Comment</span></div> ' 
                                                                        strParts += part;
                                                                    }
                                                                    if((post.comments[i].userid._id == mergeData.data._id)){
                                                                        var part = ' <div class="tooltip"> <button onclick="showDelCommentDiv(\'' + post.comments[i]._id + '\',\'' + post._id + '\')"><i class="far fa-trash-alt"></i></button><span class="tooltiptext" >Delete Comment</span></div> '
                                                                        strParts += part;
                                                                    }
    
                                                                    strParts += `
                                                                </div>
                                                            </div>
                                                            <div class="commentContent">
                                                                <p>${post.comments[i].cmnt}</p>
                                                                <div class="commentReacts" id= ${commentsOptsId}>
                                                                    <button onclick="likeComment('${post.comments[i]._id}','${dynamicCommentIds-1}')" class="commentReactions"> `;
    
                                                                        if(post.comments[i].reactions.find(o => o.username == mergeData.data.username)){
                                                                            strParts += `
                                                                            <i class="fas fa-thumbs-up likeText"></i>
                                                                            <p class="likeText">Liked</p>  `;
                                                                        }else{
                                                                            strParts += `
                                                                            <i class="far fa-thumbs-up"></i>
                                                                            <p>Like</p> `;
                                                                        }
                                                                    strParts += `
                                                                    </button> `;
    
                                                                    if(post.comments[i].reactions.length > 0) {
                                                                        strParts += `
                                                                        <button class="commentReactLen" onclick="showReactionDiv('${post.comments[i]._id}')">( ${post.comments[i].reactions.length} Likes )</button> `;
                                                                    }
                                                                strParts += `
                                                                </div>
                                                                
                                                            </div>
                                                        </div>
                                                    </div>`;
                                                }
                                                if(post.comments.length > 2){
                                                    strParts += `
                                                    <a href= /post/${post._id} class="viewAllComments">View all comments <i class="fas fa-arrow-right"></i></a> `;
                                                }
                                            }        
                                            addNewCommentId = `newCommentId-${newCommentDynamic++}`;
                                        strParts += `
                                        </div>
                                        <div class="addComment">
                                            <a href="/profile" class="commentUserProfile">
                                                <img src= ${mergeData.data.profilePhoto} alt="">
                                            </a>
                                            <form action= /comment/${post._id} onsubmit="addNewComment(event,'${newCommentDynamic-1}')" method="POST">
                                                <textarea name="comment" placeholder="Write a comment" id=${addNewCommentId} maxlength="500"></textarea>
                                                <input type="submit" value="Add Comment">
                                            </form>
                                        </div>
                                    </div> `;                            
                                    postsDiv.innerHTML += strParts;
                                    strParts = "";
                                    new ClipboardJS('.btn');

                            })
                        }
                    })
                })
                limit++;
                console.log(scrollHeight);
                if(noOfPosts >= 2){
                    currentscrollHeight = scrollHeight;
                }
            }
            if(totalPosts != 0 && totalPosts == noOfPosts && isShown == false){
                postsDiv.innerHTML += `<div class="noPosts card50">
                            <img src="../images/allSeen.svg" alt="">
                            <h6>You're all caught up.</h6>
                            <p>You've viewed all posts that your friends have posted in last 24 hours. We suggest you to add more and more friends. For now, you can click the button below to view random recent posts.</p>
                            <button onclick="showRandomPosts()">View Recent Posts</button>
                        </div>
                        <div id="suggestions" class="card50">
                            <h6>Some suggestions from Socialite</h6>
                            <div class="suggestion">
                                <div class="dot"></div>
                                <p>Always keep your profile updated.</p>
                            </div>
                            <div class="suggestion">
                                <div class="dot"></div>
                                <p>Connect with people. Add more and more friends</p>
                            </div>
                            <div class="suggestion">
                                <div class="dot"></div>
                                <p>Post regularly. Share your ideas and post photos consistently.</p>
                            </div>
                            <div class="suggestion">
                                <div class="dot"></div>
                                <p>Never share your password with anyone.</p>
                            </div>
                            <div class="suggestion">
                                <div class="dot"></div>
                                <p>Create passwords that are hard to guess and don't use personal information.</p>
                            </div>
                            <div class="suggestion">
                                <div class="dot"></div>
                                <p>Change your password every month.</p>
                            </div>
                            <div class="suggestion">
                                <div class="dot"></div>
                                <p>Don't use same password at different places.</p>
                            </div>
                            <div class="suggestion">
                                <div class="dot"></div>
                                <p>Feel free to <a href="/contact">contact us</a> for any query.</p>
                            </div>
                        </div>`;
                        isShown = true;
            }

        })
    var errMsgDivBtn = document.querySelector('#errMsgDivBtn');
    var errMsgDiv = document.querySelector('#errMsgDiv');

    errMsgDivBtn.addEventListener('click',function(){
        errMsgDiv.style.display = "none";
    })

    function showRandomPosts(){
        var showMoreDiv = document.querySelector('#showMoreDiv');
        showMoreDiv.innerHTML = `<div class="loader"></div>`;
        isShowed = false;
        fetch(`/getRandomPosts`)
        .then(data => data.json())
        .then(function(mergeData){
            mergeData.dataFound.forEach(function(post){
                noOfPosts++;
                            var strParts = `<div class="post card50">
                                        <div class="postHeader">
                                            <a href= /profile/${post.userid._id}>
                                                <img src= ${post.userid.profilePhoto} alt="">
                                            </a>
                                            <div class="postHeaderDets">
                                                <div class="postHeaderDetsTxt">
                                                    <h6>${post.userid.name}`;
                                                        if(post.userid.isVerified){
                                                            strParts += `<img src="data:image/svg+xml;base64,PHN2ZyBpZD0iTGF5ZXJfMSIgZW5hYmxlLWJhY2tncm91bmQ9Im5ldyAwIDAgNTExLjM3NSA1MTEuMzc1IiBoZWlnaHQ9IjUxMiIgdmlld0JveD0iMCAwIDUxMS4zNzUgNTExLjM3NSIgd2lkdGg9IjUxMiIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48Zz48cGF0aCBkPSJtNTExLjM3NSAyNTUuNjg3LTU3Ljg5LTY0LjI3MyA5LjA2NC04Ni4wNDUtODQuNjUtMTcuOTIxLTQzLjE4LTc1LjAxMS03OS4wMzEgMzUuMzItNzkuMDMxLTM1LjMyLTQzLjE4IDc1LjAxMS04NC42NSAxNy45MjEgOS4wNjMgODYuMDQ1LTU3Ljg5IDY0LjI3MyA1Ny44ODkgNjQuMjczLTkuMDYzIDg2LjA0NSA4NC42NSAxNy45MjEgNDMuMTggNzUuMDExIDc5LjAzMS0zNS4zMjEgNzkuMDMxIDM1LjMyMSA0My4xOC03NS4wMTEgODQuNjUtMTcuOTIxLTkuMDY0LTg2LjA0NXptLTE0OC40OTctNTUuOTg1LTEyOC4zNDUgMTQzLjc5Mi04OS4xODYtODkuMTg2IDIxLjIxMy0yMS4yMTMgNjYuNzM0IDY2LjczNCAxMDcuMjAzLTEyMC4xMDR6Ii8+PC9nPjwvc3ZnPg==" />`;
                                                        }
                                                        strParts += `
                                                        </h6>
                                                    <p>${post.when}</p>
                                                </div> `;

                                                if(post.userid.username === mergeData.loggedUser.username){
                                                    strParts += `<div class="postHeaderDetsOpts">
                                                <div class="tooltip"> <button onclick="showEditPostDiv('${post._id}')"><i class="fas fa-pencil-alt"></i></button>
                                                    <span class="tooltiptext">Edit Post</span>
                                                </div>
                                                <div class="tooltip"> <button onclick="showDelPostDiv('${post._id}')"><i class="far fa-trash-alt"></i></button>
                                                    <span class="tooltiptext" >Delete Post</span>
                                                </div>
                                            </div>`;
                                                 }
                        strParts += `  
                                            </div>
                                        </div>
                                        <div class="caption">
                                            <p>${post.content}</p>
                                        </div>`;
                                        jQuery(document).ready(function($) {
                                            $('a[data-rel^=lightcase]').lightcase();
                                        });
    
                                        if( post.media != null){
    
                                            strParts += `<a draggable="false" href= ${post.media} data-rel="lightcase" class="postImage">
                                                <img src= ${post.media}  alt="">
                                            </a>`;
                                        }
                                        postLikesId = `postLikes-${dynaIds++}`;
                                            strParts += `<div class="postReactions">
                                            <a href= /likedBy/${post._id}>
                                                <div class="postLikes" id= ${postLikesId}>
                                                    <i class="fas fa-thumbs-up likeIcon"></i><div class="postLikeNames">`;
                                            if(post.reactions.length >= 3){
                                                strParts += 
                                                `<p>Liked by ${post.reactions[0].name} and ${post.reactions.length -1} other</p>`;
                                            }else if(post.reactions.length == 2  ){
                                                strParts +=
                                                `<p>Liked by ${post.reactions[0].name} and ${post.reactions[1].name}</p>`
                                            }else if(post.reactions.length == 1){
                                                strParts += `<p>Liked by ${post.reactions[0].name}</p>`
                                                
                                            } else{
                                                strParts += `<p>0 Likes</p>`     
                                            }
                                            postOptsLikesId = `postOptsLikes-${dynamicIds++}`;
                                            
                                            strParts += `</div>
                                            <p class="mobPostLikes">${post.reactions.length} Likes</p>
                                                </div>
                                            </a>
                                            <a href= /post/${post._id}>
                                                <p class="postComments">${post.comments.length } Comments</p>
                                            </a>
                                        </div>
                                        <div class="postOptions">
                                            <button onclick="likePost('${post._id}','${dynamicIds-1}')" class="postOpts" id=${postOptsLikesId}>`;
                                                   
                                                if(post.reactions.find(o => o.username === mergeData.loggedUser.username)){
                                                    strParts += `
                                                    <i class="fas fa-thumbs-up likeIcon"></i>
                                                    <p class="likeText">Liked</p>`;
                                                }else{
                                                    strParts += `
                                                    <i class="far fa-thumbs-up postOptsIcon"></i>
                                                    <p>Like</p>`;
                                                } 
    
                                        strParts += ` </button>
                                            <a href= /post/${post._id} class="postOpts">
                                                <i class="far fa-comment-alt postOptsIcon"></i>
                                                <p>Comments</p>
                                            </a>
                                            <button class="btn postOpts" onclick="showAlert()" data-clipboard-text= ${mergeData.host}/post/${post._id}>
                                                <i class="far fa-clipboard postOptsIcon"></i>
                                                <p>Copy Link</p>
                                            </button>
                                        </div>
                                        <div class="comments"> `;       
    
                                                
                                            if(post.comments.length >= 1){
                                                var a = (post.comments.length >= 2) ? 2 : post.comments.length
                                                for(var i=0;i<a;i++) {
                                                    commentsOptsId = `commentReacts-${dynamicCommentIds++}`;
                                                    strParts += `
                                                    <div class="comment">
                                                        
                                                        <a href= /profile/${post.comments[i].userid._id} class="commentUserProfile">
                                                            <img src= ${post.comments[i].userid.profilePhoto} alt="">
                                                        </a>
                                                        <div class="commentDets">
                                                            <div class="commentDetsInfo">
                                                                <a href= /profile/${post.comments[i].userid._id}>
                                                                    <h6>${post.comments[i].userid.name}</h6>
                                                                    <p>${post.comments[i].when} </p>
                                                                </a>
                                                                <div class="commentDetsOpts"> `;
    
                                                                    if(post.comments[i].userid._id == mergeData.loggedUser._id){
                                                                        var part = '<div class="tooltip"> <button onclick="showEditCommentDiv(\'' + post.comments[i]._id + '\')"><i class="fas fa-pencil-alt"></i></button><span class="tooltiptext">Edit Comment</span></div> ' 
                                                                        strParts += part;
                                                                    }
                                                                    if((post.comments[i].userid._id == mergeData.loggedUser._id)){
                                                                        var part = ' <div class="tooltip"> <button onclick="showDelCommentDiv(\'' + post.comments[i]._id + '\',\'' + post._id + '\')"><i class="far fa-trash-alt"></i></button><span class="tooltiptext" >Delete Comment</span></div> '
                                                                        strParts += part;
                                                                    }
    
                                                                    strParts += `
                                                                </div>
                                                            </div>
                                                            <div class="commentContent">
                                                                <p>${post.comments[i].cmnt}</p>
                                                                <div class="commentReacts" id= ${commentsOptsId}>
                                                                    <button onclick="likeComment('${post.comments[i]._id}','${dynamicCommentIds-1}')" class="commentReactions"> `;
    
                                                                        if(post.comments[i].reactions.find(o => o.username == mergeData.loggedUser.username)){
                                                                            strParts += `
                                                                            <i class="fas fa-thumbs-up likeText"></i>
                                                                            <p class="likeText">Liked</p>  `;
                                                                        }else{
                                                                            strParts += `
                                                                            <i class="far fa-thumbs-up"></i>
                                                                            <p>Like</p> `;
                                                                        }
                                                                    strParts += `
                                                                    </button> `;
    
                                                                    if(post.comments[i].reactions.length > 0) {
                                                                        strParts += `
                                                                        <button class="commentReactLen" onclick="showReactionDiv('${post.comments[i]._id}')">( ${post.comments[i].reactions.length} Likes )</button> `;
                                                                    }
                                                                strParts += `
                                                                </div>
                                                                
                                                            </div>
                                                        </div>
                                                    </div>`;
                                                }
                                                if(post.comments.length > 2){
                                                    strParts += `
                                                    <a href= /post/${post._id} class="viewAllComments">View all comments <i class="fas fa-arrow-right"></i></a> `;
                                                }
                                            }        
                                            addNewCommentId = `newCommentId-${newCommentDynamic++}`;
                                        strParts += `
                                        </div>
                                        <div class="addComment">
                                            <a href="/profile" class="commentUserProfile">
                                                <img src= ${mergeData.loggedUser.profilePhoto} alt="">
                                            </a>
                                            <form action= /comment/${post._id} onsubmit="addNewComment(event,'${newCommentDynamic-1}')" method="POST">
                                                <textarea name="comment" placeholder="Write a comment" id=${addNewCommentId} maxlength="500"></textarea>
                                                <input type="submit" value="Add Comment">
                                            </form>
                                        </div>
                                    </div> `;                            
                                    postsDiv.innerHTML += strParts;
                                    strParts = "";
                                    new ClipboardJS('.btn');
                                    if(isShowed == false){
                                        showMoreDiv.innerHTML = `<button onclick="showRandomPosts()">View More Posts<i class="far fa-arrow-alt-circle-down"></i></button>`;
                                        const scrollPosition = Math.floor($(window).height() + $(window).scrollTop());
                                        window.scrollTo(scrollPosition,scrollPosition+200);
                                        isShowed = true;
                                    }
            })
        })
    }
    </script>
</body>
</html>